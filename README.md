# IQOT Platform

**Intelligent Quotation & Offer Tracking** โ ะฟะปะฐััะพัะผะฐ ะฐะฒัะพะผะฐัะธะทะฐัะธะธ ัะฑะพัะฐ ะธ ะฐะฝะฐะปะธะทะฐ ะบะพะผะผะตััะตัะบะธั ะฟัะตะดะปะพะถะตะฝะธะน.

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    IQOT Platform                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                      โ
โ   n8n (ะฐะฒัะพะผะฐัะธะทะฐัะธั)                               โ
โ     โโโ ะะฐัััะปะบะฐ ะทะฐะฟัะพัะพะฒ ะฟะพััะฐะฒัะธะบะฐะผ               โ
โ     โโโ ะกะฑะพั ะธ ะฟะฐััะธะฝะณ ะพัะฒะตัะพะฒ (AI)                 โ
โ     โโโ ะะตะฝะตัะฐัะธั ะพััััะพะฒ                           โ
โ     โโโ Webhooks โโ Laravel API                     โ
โ                                                      โ
โ   Laravel (ะฒะตะฑ-ะธะฝัะตััะตะนั)                           โ
โ     โโโ ะะตะฝะดะธะฝะณ (/)                                 โ
โ     โโโ ะะธัะฝัะน ะบะฐะฑะธะฝะตั (/cabinet)                   โ
โ     โโโ ะะดะผะธะฝ-ะฟะฐะฝะตะปั (/admin) โ Filament            โ
โ     โโโ API (/api) โ ะดะปั n8n                        โ
โ                                                      โ
โ   MySQL (ะพะฑัะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั)                         โ
โ                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะขัะตะฑะพะฒะฐะฝะธั ะบ ะทะฐัะฒะบะฐะผ

ะะปั ัะพะณะพ, ััะพะฑั ะทะฐัะฒะบะฐ ะฑัะปะฐ ะฟัะธะฝััะฐ ะฒ ัะฐะฑะพัั, ะฝะตะพะฑัะพะดะธะผะพ ัะพะฑะปัััะธ ัะปะตะดัััะธะต ััะตะฑะพะฒะฐะฝะธั:

### ะะฑัะธะต ััะตะฑะพะฒะฐะฝะธั
- **ะขะตะผะฐัะธะบะฐ**: ะทะฐะฟัะฐััะธ ะดะปั ะปะธััะพะฒ ะธ ััะบะฐะปะฐัะพัะพะฒ

### ะะพะฝัะฐะบัะฝะฐั ะธะฝัะพัะผะฐัะธั ะทะฐัะฒะธัะตะปั (ะพะฑัะทะฐัะตะปัะฝะพ)
- ะะฐะทะฒะฐะฝะธะต ะพัะณะฐะฝะธะทะฐัะธะธ
- ะะดัะตั ะพัะณะฐะฝะธะทะฐัะธะธ
- ะะะ (10 ะธะปะธ 12 ัะธัั)
- ะะะ (9 ัะธัั, ะพะฟัะธะพะฝะฐะปัะฝะพ)
- ะคะะ ะพัะฒะตัััะฒะตะฝะฝะพะณะพ ัะพัััะดะฝะธะบะฐ
- ะขะตะปะตัะพะฝ ะดะปั ัะฒัะทะธ

### ะขัะตะฑะพะฒะฐะฝะธั ะบ ะฟะพะทะธัะธัะผ ะทะฐัะฒะบะธ
ะะปั ะบะฐะถะดะพะน ะฟะพะทะธัะธะธ ะฝะตะพะฑัะพะดะธะผะพ ัะบะฐะทะฐัั:
- **ะะพะปะฝะพะต ะธ ะธััะตัะฟัะฒะฐััะตะต ะฝะฐะทะฒะฐะฝะธะต** ัะพะฒะฐัะฐ
- **ะขะธะฟ ะพะฑะพััะดะพะฒะฐะฝะธั**: ะปะธัั ะธะปะธ ััะบะฐะปะฐัะพั
- **ะะฐัะบะฐ ะพะฑะพััะดะพะฒะฐะฝะธั**
- **ะััะธะบัะป ะฟัะพะธะทะฒะพะดะธัะตะปั**

## ะกะธััะตะผะฝัะต ััะตะฑะพะฒะฐะฝะธั

- PHP 8.2+
- Composer
- MySQL 8.0+ (ะธะปะธ ัััะตััะฒัััะฐั ะะ ะพั n8n)
- Node.js 18+ (ะดะปั ัะฑะพัะบะธ assets)

## ะฃััะฐะฝะพะฒะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะทะฐะฒะธัะธะผะพััะธ

```bash
cd /var/www
git clone <repo> iqot
cd iqot

# PHP ะทะฐะฒะธัะธะผะพััะธ
composer install

# Node ะทะฐะฒะธัะธะผะพััะธ
npm install
```

### 2. ะะพะฝัะธะณััะฐัะธั

```bash
# ะะพะฟะธััะตะผ ะบะพะฝัะธะณ
cp .env.example .env

# ะะตะฝะตัะธััะตะผ ะบะปัั
php artisan key:generate
```

ะััะตะดะฐะบัะธััะนัะต `.env`:

```env
APP_URL=https://iqot.ai

# ะะฐัะฐ MySQL ะฑะฐะทะฐ (ัะฐ ะถะต, ััะพ ะธัะฟะพะปัะทัะตั n8n)
DB_HOST=127.0.0.1
DB_DATABASE=iqot
DB_USERNAME=iqot_user
DB_PASSWORD=your_password

# n8n ะฒะตะฑััะบะธ
N8N_WEBHOOK_URL=http://localhost:5678/webhook
```

### 3. ะะฐะทะฐ ะดะฐะฝะฝัั

```bash
# ะัะปะธ ะฝะพะฒะฐั ะฑะฐะทะฐ
php artisan migrate

# ะกะพะทะดะฐัั ะฐะดะผะธะฝะฐ
php artisan make:filament-user
```

### 4. ะกะฑะพัะบะฐ assets

```bash
# ะะปั ัะฐะทัะฐะฑะพัะบะธ
npm run dev

# ะะปั ะฟัะพะดะฐะบัะตะฝะฐ
npm run build
```

### 5. ะัะฐะฒะฐ ะดะพัััะฟะฐ

```bash
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache
```

## ะะฐะฟััะบ

### ะะฐะทัะฐะฑะพัะบะฐ

```bash
php artisan serve
# ะัะบัะพะนัะต http://localhost:8000
```

### ะัะพะดะฐะบัะตะฝ (Nginx)

```nginx
server {
    listen 80;
    server_name iqot.ai;
    root /var/www/iqot/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

## ๐จ Design System

ะะปะฐััะพัะผะฐ ะธัะฟะพะปัะทัะตั **IQOT Design System** โ ะฟัะพัะตััะธะพะฝะฐะปัะฝัั ัะธััะตะผั ะดะธะทะฐะนะฝะฐ ะดะปั B2B ะฟัะธะปะพะถะตะฝะธะน ะฒ ะปะธััะพะฒะพะน ะธะฝะดััััะธะธ.

### ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

- ๐จ **Industrial Precision** โ ะผะธะฝะธะผะฐะปะธััะธัะฝัะน, ััะฝะบัะธะพะฝะฐะปัะฝัะน ะดะธะทะฐะนะฝ
- ๐ฑ **ะะพะปะฝะฐั ะฐะดะฐะฟัะธะฒะฝะพััั** โ ะพั desktop ะดะพ mobile
- ๐ต **ะฆะฒะตัะพะฒะฐั ะฟะฐะปะธััะฐ** โ Industrial Blue + Industrial Orange
- ๐ค **ะขะธะฟะพะณัะฐัะธะบะฐ** โ DM Sans (UI) + JetBrains Mono (ะบะพะดั)
- ๐งฉ **Blade ะบะพะผะฟะพะฝะตะฝัั** โ ะณะพัะพะฒัะต ะฟะตัะตะธัะฟะพะปัะทัะตะผัะต ัะปะตะผะตะฝัั
- ๐ฏ **Lucide Icons** โ ัะพะฒัะตะผะตะฝะฝัะต SVG ะธะบะพะฝะบะธ

### ะะพะบัะผะตะฝัะฐัะธั

- **[DESIGN_SYSTEM_README.md](./DESIGN_SYSTEM_README.md)** โ ะพะฑะทะพั ะฒะฝะตะดัะตะฝะธั
- **[DESIGN_SYSTEM_USAGE.md](./DESIGN_SYSTEM_USAGE.md)** โ ะฟะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ
- **[COMPONENTS_QUICK_REFERENCE.md](./COMPONENTS_QUICK_REFERENCE.md)** โ ะฑััััะฐั ัะฟัะฐะฒะบะฐ

### ะะพัะพะฒัะต ะบะพะผะฟะพะฝะตะฝัั

```blade
<!-- Badges ะดะปั ััะฐัััะพะฒ -->
<x-badge type="completed">ะะฐะฒะตััะตะฝะพ</x-badge>

<!-- ะะฝะพะฟะบะธ ั ะธะบะพะฝะบะฐะผะธ -->
<x-button variant="accent" icon="plus" :href="route('create')">
    ะกะพะทะดะฐัั ะทะฐัะฒะบั
</x-button>

<!-- Page Header -->
<x-page-header title="ะะฐะณะพะปะพะฒะพะบ" description="ะะฟะธัะฐะฝะธะต">
    <x-slot:actions>
        <x-button>ะะตะนััะฒะธะต</x-button>
    </x-slot:actions>
</x-page-header>

<!-- Stat Cards -->
<x-stat-card value="42" label="ะัะตะณะพ" icon="file-text" icon-type="primary" />

<!-- Empty State -->
<x-empty-state icon="inbox" title="ะะตั ะดะฐะฝะฝัั">
    <x-slot:action>
        <x-button>ะกะพะทะดะฐัั</x-button>
    </x-slot:action>
</x-empty-state>
```

### ะะตัะตะพัะพัะผะปะตะฝะฝัะต ัััะฐะฝะธัั

- โ Layout ั ัะตะผะฝัะผ sidebar ะธ responsive navigation
- โ Dashboard ั stat cards ะธ ัะฐะฑะปะธัะฐะผะธ
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐัะฒะบะฐะผะธ ั ัะธะปัััะฐะผะธ ะธ ะฟะฐะณะธะฝะฐัะธะตะน
- โ ะัะต ัะพัะผั ะธ ะธะฝะฟััั ะฟะพ ะฝะพะฒะพะผั ััะธะปั

## ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ะปะธัะฝะพะณะพ ะบะฐะฑะธะฝะตัะฐ

### ะกะพะทะดะฐะฝะธะต ะทะฐัะฒะพะบ
- **AI-ะฟะฐััะธะฝะณ** ัะตะบััะฐ ะทะฐัะฒะบะธ ัะตัะตะท n8n (ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต ะฟะพะทะธัะธะน, ะฑัะตะฝะดะพะฒ, ะฐััะธะบัะปะพะฒ)
- **ะะฐะปะธะดะฐัะธั** ะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟะพะทะธัะธะน ะฟะตัะตะด ัะพะทะดะฐะฝะธะตะผ
- **ะกะธััะตะผะฐ ัะฐัะธัะพะฒ** ั ะตะถะตะผะตัััะฝัะผะธ ะปะธะผะธัะฐะผะธ ะธ ัะตะฝะฐะผะธ ะทะฐ ะฟัะตะฒััะตะฝะธะต
- **ะฃะผะฝะฐั ะทะฐะผะพัะพะทะบะฐ ััะตะดััะฒ** ะฝะฐ ะฒัะตะผั ะพะฑัะฐะฑะพัะบะธ ะทะฐัะฒะบะธ

### ะััะตัั ะฟะพ ะทะฐัะฒะบะฐะผ
- **ะกัะฐะฒะฝะธัะตะปัะฝัะน ะฐะฝะฐะปะธะท** ะะ ะพั ัะฐะทะฝัั ะฟะพััะฐะฒัะธะบะพะฒ
- **ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฐััะตั** ะปัััะธั ะฟัะตะดะปะพะถะตะฝะธะน
- **ะญะบัะฟะพัั ะฒ PDF** (ะดะพัััะฟะตะฝ ะฝะฐ ัะฐัะธัะฐั Extended ะธ Professional)
- **ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน** ััะฐัััะพะฒ ะทะฐัะฒะบะธ
- **ะะพัััะฟ ะบ ััะถะธะผ ะพััะตัะฐะผ** (ะฟะปะฐัะฝะพ, ัะพะณะปะฐัะฝะพ ัะฐัะธัั)

### ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะฐะปะฐะฝัะพะผ ะธ ัะฐัะธัะฐะผะธ
- **ะขะฐัะธัะฝัะต ะฟะปะฐะฝั**: Start (ะฑะตัะฟะปะฐัะฝัะน), Basic, Extended, Professional
- **ะะธะผะธัั ะฝะฐ ะฟะพะทะธัะธะธ** ะฒ ะทะฐัะฒะบะฐั ะธ ะพัะบัััะธะต ะพััะตัะพะฒ
- **ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฟะธัะฐะฝะธะต** ััะตะดััะฒ ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ ะฟะพะทะธัะธะน (3+ ะฟัะตะดะปะพะถะตะฝะธะน)
- **ะงะฐััะธัะฝะฐั ัะฐะทะผะพัะพะทะบะฐ** ััะตะดััะฒ ะทะฐ ะฝะตะฒัะฟะพะปะฝะตะฝะฝัะต ะฟะพะทะธัะธะธ ัะตัะตะท 7 ะดะฝะตะน
- **ะะตัะฐะปะธะทะฐัะธั ัะฐััะพะดะพะฒ** ั ัะธะปัััะฐัะธะตะน ะฟะพ ะฟะตัะธะพะดะฐะผ
- **ะะพะฟะพะปะฝะตะฝะธะต ะฑะฐะปะฐะฝัะฐ** (ะธะฝัะตะณัะฐัะธั ั ะฟะปะฐัะตะถะฝัะผะธ ัะธััะตะผะฐะผะธ)

## ะกะธััะตะผะฐ ัะฐัะธัะธะบะฐัะธะธ ะธ ะฑะธะปะปะธะฝะณะฐ

### ะะฒัะพะผะฐัะธัะตัะบะฐั ะพะฑัะฐะฑะพัะบะฐ ะฟะปะฐัะตะถะตะน

ะะปะฐััะพัะผะฐ ะธัะฟะพะปัะทัะตั **ะฟะพะปะฝะพัััั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัั ัะธััะตะผั ัะฟะธัะฐะฝะธั ะธ ัะฐะทะผะพัะพะทะบะธ ััะตะดััะฒ**:

1. **ะัะธ ัะพะทะดะฐะฝะธะธ ะทะฐัะฒะบะธ:**
   - ะะฐัััะธััะฒะฐะตััั ััะพะธะผะพััั ะฝะฐ ะพัะฝะพะฒะต ัะฐัะธัะฐ ะธ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะปะธะผะธัะพะฒ
   - ะกัะตะดััะฒะฐ ะทะฐะผะพัะฐะถะธะฒะฐัััั ะฝะฐ ะฑะฐะปะฐะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั
   - ะะฐัะฒะบะฐ ะพัะฟัะฐะฒะปัะตััั ะฒ ัะฐะฑะพัั

2. **ะัะธ ะฟะพะปััะตะฝะธะธ ะฟัะตะดะปะพะถะตะฝะธะน (ะฐะฒัะพะผะฐัะธัะตัะบะธ):**
   - ะะพะณะดะฐ ะฟะพะทะธัะธั ะฝะฐะฑะธัะฐะตั **3+ ะฟัะตะดะปะพะถะตะฝะธั** ะพั ะฟะพััะฐะฒัะธะบะพะฒ
   - ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฟะธััะฒะฐะตั ััะตะดััะฒะฐ ะทะฐ ััั ะฟะพะทะธัะธั
   - ะะพะปัะทะพะฒะฐัะตะปั ะฟะพะปััะฐะตั ะดะพัััะฟ ะบ ััะฐะฒะฝะธัะตะปัะฝะพะผั ะพััะตัั

3. **ะงะตัะตะท 7 ะดะฝะตะน ะฟะพัะปะต ัะพะทะดะฐะฝะธั (ะฐะฒัะพะผะฐัะธัะตัะบะธ):**
   - ะะปั ะฟะพะทะธัะธะน, ะฝะต ะฝะฐะฑัะฐะฒัะธั 3+ ะฟัะตะดะปะพะถะตะฝะธะน
   - ะกัะตะดััะฒะฐ **ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะผะพัะฐะถะธะฒะฐัััั** ะธ ะฒะพะทะฒัะฐัะฐัััั ะฝะฐ ะฑะฐะปะฐะฝั
   - ะะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฟะปะฐัะธั ะทะฐ ะฝะตะฒัะฟะพะปะฝะตะฝะฝัะต ะฟะพะทะธัะธะธ

### ะขะฐัะธัะฝัะต ะฟะปะฐะฝั

| ะะปะฐะฝ | ะฆะตะฝะฐ/ะผะตั | ะะพะทะธัะธะน | ะััะตัะพะฒ | ะกะฒะตัั ะปะธะผะธัะฐ (ะฟะพะทะธัะธั) | ะกะฒะตัั ะปะธะผะธัะฐ (ะพััะตั) | PDF |
|------|----------|---------|---------|------------------------|----------------------|-----|
| **Start** | 0 โฝ | 10 | 5 | 50 โฝ | 100 โฝ | โ |
| **Basic** | 2,900 โฝ | 50 | 25 | 45 โฝ | 90 โฝ | โ |
| **Extended** | 5,900 โฝ | 150 | 75 | 35 โฝ | 70 โฝ | โ |
| **Professional** | 12,900 โฝ | 500 | 250 | 25 โฝ | 50 โฝ | โ |

### ะขะตัะฝะธัะตัะบะธะต ะบะพะผะฟะพะฝะตะฝัั

**ะะพะดะตะปะธ:**
- `TariffPlan` โ ัะฐัะธัะฝัะต ะฟะปะฐะฝั ั ะปะธะผะธัะฐะผะธ ะธ ัะตะฝะฐะผะธ
- `UserTariff` โ ะฐะบัะธะฒะฝะฐั ะฟะพะดะฟะธัะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- `BalanceHold` โ ะทะฐะผะพัะพะทะบะฐ ััะตะดััะฒ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐัะฒะบะธ
- `BalanceCharge` โ ะดะตัะฐะปะธะทะฐัะธั ัะฟะธัะฐะฝะธะน ะฟะพ ะฟะพะทะธัะธัะผ
- `ReportAccess` โ ััะตั ะฟัะพัะผะพััะพะฒ ััะถะธั ะพััะตัะพะฒ
- `BalanceTransaction` โ ะธััะพัะธั ะฒัะตั ะพะฟะตัะฐัะธะน ั ะฑะฐะปะฐะฝัะพะผ

**Observers (ะฐะฒัะพะผะฐัะธัะตัะบะธะต ััะธะณะณะตัั):**
- `ExternalOfferObserver` โ ะพะฑะฝะพะฒะปัะตั ััะตััะธะบ ะฟัะตะดะปะพะถะตะฝะธะน (`offers_count`)
- `ExternalRequestItemObserver` โ ัะฟะธััะฒะฐะตั ััะตะดััะฒะฐ ะฟัะธ ะดะพััะธะถะตะฝะธะธ 3+ ะฟัะตะดะปะพะถะตะฝะธะน

**Commands (ะฟะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐั):**
- `balance:release-expired` โ ัะฐะทะผะพัะฐะถะธะฒะฐะตั ััะตะดััะฒะฐ ัะตัะตะท 7 ะดะฝะตะน
- `tariffs:renew` โ ะฟัะพะดะปะตะฒะฐะตั ัะฐัะธัั ะธ ะพะฑะฝัะปัะตั ะปะธะผะธัั

**ะะพะฝััะพะปะปะตัั:**
- `TariffController` โ ัะฟัะฐะฒะปะตะฝะธะต ัะฐัะธัะฐะผะธ ะฒ ะะ
- `BalanceController` โ ะพะฟะตัะฐัะธะธ ั ะฑะฐะปะฐะฝัะพะผ

ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั: **[BILLING_SYSTEM_STRUCTURE.md](./BILLING_SYSTEM_STRUCTURE.md)**

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
iqot/
โโโ app/
โ   โโโ Http/Controllers/
โ   โ   โโโ LandingController.php            # ะะตะฝะดะธะฝะณ
โ   โ   โโโ CabinetController.php            # ะะธัะฝัะน ะบะฐะฑะธะฝะตั
โ   โ   โโโ UserRequestController.php        # ะะฐัะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โ   โโโ TariffController.php             # ะฃะฟัะฐะฒะปะตะฝะธะต ัะฐัะธัะฐะผะธ
โ   โ   โโโ BalanceController.php            # ะะฟะตัะฐัะธะธ ั ะฑะฐะปะฐะฝัะพะผ
โ   โ   โโโ Admin/
โ   โ   โ   โโโ RequestController.php        # ะะดะผะธะฝ: ะผะพะดะตัะฐัะธั ะทะฐัะฒะพะบ
โ   โ   โ   โโโ ManageRequestController.php  # ะะดะผะธะฝ: ัะพะทะดะฐะฝะธะต ะทะฐัะฒะพะบ (n8n)
โ   โ   โ   โโโ UserController.php           # ะะดะผะธะฝ: ะฟะพะปัะทะพะฒะฐัะตะปะธ
โ   โ   โ   โโโ UserSenderController.php     # ะะดะผะธะฝ: ะฝะฐัััะพะนะบะฐ email
โ   โ   โ   โโโ SettingsController.php       # ะะดะผะธะฝ: ะฝะฐัััะพะนะบะธ
โ   โ   โ   โโโ DiagnosticsController.php    # ะะดะผะธะฝ: ะดะธะฐะณะฝะพััะธะบะฐ
โ   โ   โโโ Api/
โ   โ       โโโ WebhookController.php        # n8n ะฒะตะฑััะบะธ
โ   โโโ Models/
โ   โ   โโโ User.php                         # ะะพะปัะทะพะฒะฐัะตะปะธ
โ   โ   โโโ Request.php                      # ะะฐัะฒะบะธ (ะะ iqot)
โ   โ   โโโ RequestItem.php                  # ะะพะทะธัะธะธ ะทะฐัะฒะบะธ
โ   โ   โโโ TariffPlan.php                   # ะขะฐัะธัะฝัะต ะฟะปะฐะฝั
โ   โ   โโโ UserTariff.php                   # ะะพะดะฟะธัะบะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โ   โ   โโโ BalanceHold.php                  # ะะฐะผะพัะพะทะบะฐ ััะตะดััะฒ
โ   โ   โโโ BalanceCharge.php                # ะกะฟะธัะฐะฝะธั ะฟะพ ะฟะพะทะธัะธัะผ
โ   โ   โโโ BalanceTransaction.php           # ะััะพัะธั ััะฐะฝะทะฐะบัะธะน
โ   โ   โโโ ReportAccess.php                 # ะะพัััะฟ ะบ ะพััะตัะฐะผ
โ   โ   โโโ SystemSetting.php                # ะะฐัััะพะนะบะธ ัะธััะตะผั
โ   โ   โโโ ClientOrganization.php           # ะัะณะฐะฝะธะทะฐัะธะธ (ะะ reports)
โ   โ   โโโ Category.php                     # ะะฐัะตะณะพัะธะธ (ะะ reports)
โ   โ   โโโ ProductType.php                  # ะขะธะฟั ัะพะฒะฐัะพะฒ (ะะ reports)
โ   โ   โโโ ApplicationDomain.php            # ะะฑะปะฐััะธ ะฟัะธะผะตะฝะตะฝะธั (ะะ reports)
โ   โ   โโโ ExternalRequest.php              # ะะฐัะฒะบะธ (ะะ reports)
โ   โ   โโโ ExternalRequestItem.php          # ะะพะทะธัะธะธ ะทะฐัะฒะพะบ (ะะ reports)
โ   โ   โโโ ExternalOffer.php                # ะัะตะดะปะพะถะตะฝะธั ะฟะพััะฐะฒัะธะบะพะฒ (ะะ reports)
โ   โ   โโโ Supplier.php                     # ะะพััะฐะฒัะธะบะธ
โ   โ   โโโ Offer.php                        # ะะ
โ   โโโ Observers/
โ   โ   โโโ ExternalOfferObserver.php        # ะะฑะฝะพะฒะปะตะฝะธะต offers_count
โ   โ   โโโ ExternalRequestItemObserver.php  # ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฟะธัะฐะฝะธะต
โ   โโโ Console/Commands/
โ   โ   โโโ ReleaseExpiredBalanceHoldsCommand.php  # ะะฐะทะผะพัะพะทะบะฐ ัะตัะตะท 7 ะดะฝะตะน
โ   โ   โโโ RenewTariffsCommand.php          # ะัะพะดะปะตะฝะธะต ัะฐัะธัะพะฒ
โ   โโโ Services/
โ       โโโ N8nRequestService.php            # API ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะทะฐัะฒะบะฐะผะธ (n8n)
โ       โโโ N8nParseService.php              # AI-ะฟะฐััะธะฝะณ ัะตัะตะท n8n
โ       โโโ N8nSenderService.php             # ะัะฟัะฐะฒะบะฐ ัะตัะตะท n8n
โ       โโโ RequestSyncService.php           # ะกะธะฝััะพะฝะธะทะฐัะธั ั ะะ reports
โโโ routes/
โ   โโโ web.php                           # ะะตะฑ-ัะพััั
โ   โโโ api.php                           # API ะดะปั n8n
โโโ resources/views/
โ   โโโ landing/                          # ะะตะฝะดะธะฝะณ
โ   โโโ cabinet/                          # ะะธัะฝัะน ะบะฐะฑะธะฝะตั
โ   โโโ requests/                         # ะะฐัะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ะพััะตัั
โ   โ   โโโ create.blade.php              # ะกะพะทะดะฐะฝะธะต ะทะฐัะฒะบะธ
โ   โ   โโโ index.blade.php               # ะกะฟะธัะพะบ ะทะฐัะฒะพะบ
โ   โ   โโโ show.blade.php                # ะัะพัะผะพัั ะทะฐัะฒะบะธ
โ   โ   โโโ report.blade.php              # ะััะตั ะฟะพ ะทะฐัะฒะบะต
โ   โโโ admin/
โ       โโโ requests/                     # ะะพะดะตัะฐัะธั ะทะฐัะฒะพะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โ       โโโ manage/
โ           โโโ requests/                 # ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐัะฒะบะฐะผะธ ัะตัะตะท n8n
โ               โโโ index.blade.php       # ะกะฟะธัะพะบ ะทะฐัะฒะพะบ
โ               โโโ create.blade.php      # ะกะพะทะดะฐะฝะธะต ั AI-ะฟะฐััะธะฝะณะพะผ
โ               โโโ edit.blade.php        # ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต
โ               โโโ show.blade.php        # ะัะพัะผะพัั
โโโ public/images/                        # ะะพะณะพัะธะฟั, ะธะบะพะฝะบะธ
```

## ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ะฐะดะผะธะฝ-ะฟะฐะฝะตะปะธ

### ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐัะฒะบะฐะผะธ ัะตัะตะท n8n (ะฝะพะฒะพะต!)

ะะดะผะธะฝะธัััะฐัะพัั ะผะพะณัั ัะพะทะดะฐะฒะฐัั ะทะฐัะฒะบะธ ะฝะฐ ัะฐัััะปะบั ะฟะพััะฐะฒัะธะบะฐะผ:

- **ะะฝะพะฝะธะผะฝัะต ะทะฐัะฒะบะธ** โ ะฑะตะท ะฟัะธะฒัะทะบะธ ะบ ะบะปะธะตะฝัั
- **ะะผะตะฝะฝัะต ะทะฐัะฒะบะธ** โ ะดะปั ะบะพะฝะบัะตัะฝะพะน ะพัะณะฐะฝะธะทะฐัะธะธ
- **AI-ะฟะฐััะธะฝะณ ัะตะบััะฐ** โ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต ะฟะพะทะธัะธะน
- **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะฐัััะปะบะฐ** โ ะบะฐะถะดัะต 60 ะผะธะฝัั ัะตัะตะท n8n

**ะะพัััะฟ:** `/manage/manage-requests` (ััะตะฑัะตััั is_admin = true)

ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั: [ADMIN_REQUESTS_SETUP.md](ADMIN_REQUESTS_SETUP.md)

## ะะฐัััััั ะฟัะธะปะพะถะตะฝะธั

### ะะธัะฝัะน ะบะฐะฑะธะฝะตั (ััะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั)

```
# ะะฐัะฑะพัะด ะธ ะฟัะพัะธะปั
GET  /cabinet                           # ะะฐัะฑะพัะด
GET  /cabinet/settings                  # ะะฐัััะพะนะบะธ ะฟัะพัะธะปั

# ะะฐัะฒะบะธ
GET  /cabinet/requests                  # ะะพะธ ะทะฐัะฒะบะธ
GET  /cabinet/requests/create           # ะกะพะทะดะฐะฝะธะต ะทะฐัะฒะบะธ
POST /cabinet/requests/parse            # AI-ะฟะฐััะธะฝะณ ัะตะบััะฐ
POST /cabinet/requests                  # ะกะพััะฐะฝะตะฝะธะต ะทะฐัะฒะบะธ
GET  /cabinet/requests/{id}             # ะัะพัะผะพัั ะทะฐัะฒะบะธ
GET  /cabinet/requests/{id}/report      # ะััะตั ะฟะพ ะทะฐัะฒะบะต

# ะขะฐัะธัั ะธ ะฑะฐะปะฐะฝั
GET  /cabinet/tariff                    # ะฃะฟัะฐะฒะปะตะฝะธะต ัะฐัะธัะฐะผะธ
GET  /cabinet/tariff/transactions       # ะะตัะฐะปะธะทะฐัะธั ัะฐััะพะดะพะฒ
POST /cabinet/tariff/subscribe/{id}     # ะะพะดะฟะธัะบะฐ ะฝะฐ ัะฐัะธั
GET  /cabinet/balance                   # ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะฐะปะฐะฝัะพะผ
POST /cabinet/balance/deposit           # ะะพะฟะพะปะฝะตะฝะธะต ะฑะฐะปะฐะฝัะฐ
GET  /cabinet/balance/check             # ะัะพะฒะตัะบะฐ ะฑะฐะปะฐะฝัะฐ (AJAX)

# ะััะตัั ะธ ะฟะพะทะธัะธะธ
GET  /cabinet/items                     # ะะฐัะฐะปะพะณ ะฟะพะทะธัะธะน
GET  /cabinet/items/{id}                # ะะตัะฐะปะธ ะฟะพะทะธัะธะธ (ะฟะปะฐัะฝะพ)
```

### ะะดะผะธะฝ-ะฟะฐะฝะตะปั (ััะตะฑัะตััั is_admin = true)

```
# ะะพะดะตัะฐัะธั ะทะฐัะฒะพะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
GET  /manage/requests                   # ะะฐัะฒะบะธ ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
GET  /manage/requests/{id}              # ะะตัะฐะปะธ ะทะฐัะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั
POST /manage/requests/{id}/approve      # ะะดะพะฑัะธัั ะทะฐัะฒะบั
POST /manage/requests/{id}/reject       # ะัะบะปะพะฝะธัั ะทะฐัะฒะบั

# ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐัะฒะบะฐะผะธ ัะตัะตะท n8n (ะฝะพะฒะพะต!)
GET  /manage/manage-requests            # ะกะฟะธัะพะบ ะทะฐัะฒะพะบ ะธะท n8n
GET  /manage/manage-requests/create     # ะกะพะทะดะฐัั ะทะฐัะฒะบั
POST /manage/manage-requests            # ะกะพััะฐะฝะธัั ะทะฐัะฒะบั
GET  /manage/manage-requests/{id}       # ะัะพัะผะพัั ะทะฐัะฒะบะธ
GET  /manage/manage-requests/{id}/edit  # ะะตะดะฐะบัะธัะพะฒะฐัั ะทะฐัะฒะบั
PUT  /manage/manage-requests/{id}       # ะะฑะฝะพะฒะธัั ะทะฐัะฒะบั
POST /manage/manage-requests/{id}/cancel # ะัะผะตะฝะธัั ะทะฐัะฒะบั
POST /manage/manage-requests/parse-text # AI-ะฟะฐััะธะฝะณ (AJAX)

# ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
GET  /manage/users                      # ะะพะปัะทะพะฒะฐัะตะปะธ
GET  /manage/users/{id}                 # ะัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั
GET  /manage/users/{id}/sender/create   # ะกะพะทะดะฐัั email-ะพัะฟัะฐะฒะธัะตะปั
POST /manage/users/{id}/sender          # ะกะพััะฐะฝะธัั email-ะพัะฟัะฐะฒะธัะตะปั

# ะะฐัััะพะนะบะธ ะธ ะดะธะฐะณะฝะพััะธะบะฐ
GET  /manage/settings                   # ะะฐัััะพะนะบะธ ัะธััะตะผั
GET  /manage/diagnostics                # ะะธะฐะณะฝะพััะธะบะฐ n8n
```

### API ะดะปั n8n

#### ะะตะฑััะบะธ (ะฒัะพะดััะธะต ะพั n8n)

```
POST /api/webhooks/request-update   # ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ ะทะฐัะฒะบะธ
POST /api/webhooks/offer-received   # ะะพะฒะพะต ะะ ะพั ะฟะพััะฐะฒัะธะบะฐ
POST /api/webhooks/report-ready     # ะัััั ะณะพัะพะฒ
POST /api/webhooks/email-status     # ะกัะฐััั email
```

#### ะะฐัะธััะฝะฝัะต ัะฝะดะฟะพะธะฝัั (ั Sanctum ัะพะบะตะฝะพะผ)

```
GET  /api/requests                  # ะกะฟะธัะพะบ ะทะฐัะฒะพะบ
POST /api/requests                  # ะกะพะทะดะฐัั ะทะฐัะฒะบั
GET  /api/suppliers                 # ะกะฟะธัะพะบ ะฟะพััะฐะฒัะธะบะพะฒ
GET  /api/reports/{id}/pdf          # ะกะบะฐัะฐัั PDF
```

## ะะฐัััะพะนะบะฐ ัะธััะตะผั

### ะะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐั (Laravel Scheduler)

ะะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ัะฐะฑะพัั ัะธััะตะผั ะฑะธะปะปะธะฝะณะฐ ะฝะตะพะฑัะพะดะธะผะพ ะฝะฐัััะพะธัั cron:

```bash
* * * * * cd /var/www/iqot-platform && php artisan schedule:run >> /dev/null 2>&1
```

**ะะฒัะพะผะฐัะธัะตัะบะธะต ะทะฐะดะฐัะธ:**
- `balance:release-expired` โ ะตะถะตะดะฝะตะฒะฝะพ ะฒ 00:00, ัะฐะทะผะพัะฐะถะธะฒะฐะตั ััะตะดััะฒะฐ ะทะฐ ะฝะตะฒัะฟะพะปะฝะตะฝะฝัะต ะฟะพะทะธัะธะธ
- `tariffs:renew` โ ะตะถะตะดะฝะตะฒะฝะพ ะฒ 00:00, ะฟัะพะดะปะตะฒะฐะตั ัะฐัะธัั ะธ ะพะฑะฝัะปัะตั ะปะธะผะธัั

### ะะฐะทะพะฒัะต ะฝะฐัััะพะนะบะธ (ัะตัะตะท ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั)

ะะพัััะฟะฝะพ ะฟะพ ะฐะดัะตัั `/admin/settings`:

- **n8n_webhook_url** โ URL ะฒะตะฑััะบะฐ n8n ะดะปั ะพัะฟัะฐะฒะบะธ ะทะฐัะฒะพะบ
- **default_request_timeout** โ ัะฐะนะผะฐัั ะพะฑัะฐะฑะพัะบะธ ะทะฐัะฒะบะธ (ะฒ ัะฐัะฐั)

### Email-ะพัะฟัะฐะฒะธัะตะปะธ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

ะะปั ะบะฐะถะดะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะฐะดะผะธะฝ ะดะพะปะถะตะฝ ะฝะฐัััะพะธัั email-ะพัะฟัะฐะฒะธัะตะปั ัะตัะตะท `/admin/users/{id}/sender/create`:

- ะะพััะพะฒัะน ัะตัะฒะตั (host, port, encryption)
- ะฃัะตัะฝัะต ะดะฐะฝะฝัะต (username, password)
- ะะฐะฝะฝัะต ะพัะณะฐะฝะธะทะฐัะธะธ (ะฝะฐะทะฒะฐะฝะธะต, ะะะ, ะะะ, ะฐะดัะตั)
- ะะพะฝัะฐะบัะฝะฐั ะธะฝัะพัะผะฐัะธั

### ะะธะฐะณะฝะพััะธะบะฐ n8n

ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ n8n ะดะพัััะฟะฝะฐ ะฒ `/admin/diagnostics`:

- ะขะตััะธัะพะฒะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธั
- ะัะพะฒะตัะบะฐ ะฒะตะฑััะบะพะฒ
- ะะพะณะธ ะฒะทะฐะธะผะพะดะตะนััะฒะธั

## ะะฝัะตะณัะฐัะธั ั n8n

ะะปะฐััะพัะผะฐ ะธัะฟะพะปัะทัะตั ะดะฒะต ะฑะฐะทั ะดะฐะฝะฝัั:

1. **iqot-platform** (Laravel) โ ะฟะพะปัะทะพะฒะฐัะตะปะธ, ัะฐัะธัั, ะฑะฐะปะฐะฝั, ะทะฐัะฒะบะธ ะบะปะธะตะฝัะพะฒ
2. **external** (n8n) โ ะพะฑัะฐะฑะพัะฐะฝะฝัะต ะทะฐัะฒะบะธ, ะฟัะตะดะปะพะถะตะฝะธั ะฟะพััะฐะฒัะธะบะพะฒ

### ะัะพัะตัั ะพะฑัะฐะฑะพัะบะธ ะทะฐัะฒะบะธ ะธ ะฑะธะปะปะธะฝะณะฐ

1. **ะกะพะทะดะฐะฝะธะต ะทะฐัะฒะบะธ:**
   - ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะตั ะทะฐัะฒะบั ัะตัะตะท `/cabinet/requests/create`
   - AI ะฟะฐััะธั ัะตะบัั ัะตัะตะท n8n (`N8nParseService`)
   - ะะฐัััะธััะฒะฐะตััั ััะพะธะผะพััั ะฝะฐ ะพัะฝะพะฒะต ัะฐัะธัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
   - ะกัะตะดััะฒะฐ ะทะฐะผะพัะฐะถะธะฒะฐัััั (`BalanceHold`)
   - ะะฐัะฒะบะฐ ัะพััะฐะฝัะตััั ะฒ ะะ `iqot-platform`

2. **ะัะฟัะฐะฒะบะฐ ะฟะพััะฐะฒัะธะบะฐะผ:**
   - ะะฐัะฒะบะฐ ะพัะฟัะฐะฒะปัะตััั ะฒ n8n (`N8nSenderService`)
   - n8n ัะพะทะดะฐะตั `ExternalRequest` ะฒ ะะ `external`
   - ะะฐัััะปะบะฐ email ะฟะพััะฐะฒัะธะบะฐะผ ัะตัะตะท n8n

3. **ะะพะปััะตะฝะธะต ะฟัะตะดะปะพะถะตะฝะธะน (ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะฟะธัะฐะฝะธะต):**
   - ะะพััะฐะฒัะธะบ ะพัะฒะตัะฐะตั โ ัะพะทะดะฐะตััั `ExternalOffer` ะฒ ะะ `external`
   - `ExternalOfferObserver` ัะฒะตะปะธัะธะฒะฐะตั `offers_count` ะดะปั ะฟะพะทะธัะธะธ
   - ะัะธ `offers_count >= 3` โ `ExternalRequestItemObserver` ัะฟะธััะฒะฐะตั ััะตะดััะฒะฐ
   - `BalanceCharge` ัะพะทะดะฐะตััั ะดะปั ะฟะพะทะธัะธะธ, `BalanceHold` ัะผะตะฝััะฐะตััั

4. **ะัะพัะผะพัั ะพััะตัะฐ:**
   - ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ะพััะตั ะฒ `/cabinet/requests/{id}/report`
   - ะกัะฐะฒะฝะธัะตะปัะฝัะน ะฐะฝะฐะปะธะท ะฟัะตะดะปะพะถะตะฝะธะน ะพั ะฟะพััะฐะฒัะธะบะพะฒ

5. **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะฐะทะผะพัะพะทะบะฐ (ัะตัะตะท 7 ะดะฝะตะน):**
   - ะะพะผะฐะฝะดะฐ `balance:release-expired` ะทะฐะฟััะบะฐะตััั ะตะถะตะดะฝะตะฒะฝะพ
   - ะะปั ะฟะพะทะธัะธะน ั `offers_count < 3` ััะตะดััะฒะฐ ะฒะพะทะฒัะฐัะฐัััั ะฝะฐ ะฑะฐะปะฐะฝั
   - ะงะฐััะธัะฝะฐั ัะฐะทะผะพัะพะทะบะฐ ะทะฐ ะฝะตะฒัะฟะพะปะฝะตะฝะฝัะต ะฟะพะทะธัะธะธ

### ะกะธะฝััะพะฝะธะทะฐัะธั ะดะฐะฝะฝัั ะผะตะถะดั ะะ

ะะพะดะตะปะธ ัะฐะฑะพัะฐัั ั ะะ `external` ัะตัะตะท ะพัะดะตะปัะฝะพะต ะฟะพะดะบะปััะตะฝะธะต:

```php
// app/Models/ExternalRequest.php
protected $connection = 'reports';  // ะะพะดะบะปััะตะฝะธะต ะบ ะะ external

// app/Models/ExternalRequestItem.php
protected $connection = 'reports';

// app/Models/ExternalOffer.php
protected $connection = 'reports';
```

**ะกะฒัะทั ะผะตะถะดั ะฑะฐะทะฐะผะธ ะดะฐะฝะฝัั:**
- `Request` (iqot-platform) โ `ExternalRequest` (external) โ ัะตัะตะท ะฟะพะปะต `request_number`
- `BalanceHold` (iqot-platform) โ `ExternalRequestItem` (external) โ ัะตัะตะท `request_number`
- `BalanceCharge` (iqot-platform) โ `ExternalRequestItem` (external) โ ัะตัะตะท `external_request_item_id`

ะญัะพ ะฟะพะทะฒะพะปัะตั:
- ะะพะปััะฐัั ะดะฐะฝะฝัะต ะพ ะฟัะตะดะปะพะถะตะฝะธัั ะฑะตะท ะดัะฑะปะธัะพะฒะฐะฝะธั
- ะะฒัะพะผะฐัะธัะตัะบะธ ะพััะปะตะถะธะฒะฐัั ะธะทะผะตะฝะตะฝะธั ัะตัะตะท Observers
- ะะตััะธ ะดะตัะฐะปัะฝัะน ััะตั ัะฐััะพะดะพะฒ ะฟะพ ะบะฐะถะดะพะน ะฟะพะทะธัะธะธ

## ะัะตัะตะดะธ (ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน)

```bash
# ะะฐะฟััะบ ะฒะพัะบะตัะฐ
php artisan queue:work

# ะะปะธ ัะตัะตะท Supervisor (ะฟัะพะดะฐะบัะตะฝ)
```

## ะะธัะตะฝะทะธั

Proprietary ยฉ IQOT 2025
